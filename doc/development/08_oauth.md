## OAuth 2.0
OAuth allows users to grant other applications access to their data from hitobito, without giving them their password.

#### Managing OAuth Applications in Hitobito
Users with admin privilege on the application root group (e.g. "Bundesebene") are allowed to manage the OAuth applications.

Applications can be limited to a URL and scope. The OAuth application is defined by it's Uid, generated by the system.

#### Scopes

| Name | Available user data |
| --- | --- |
| email | id, email |
| name | id, email, firstname, lastname, nickname |
| with_roles | All the profile data, roles within groups |

The scope "with_roles" contains most of the profile information, including the fields of the name scope. Multiple scopes can be combined in a single authorization request. 

## OAuth Flow

### Get the Userâ€™s Permission
If an application requests permission through OAuth, the users must first grant their permission through the authorize dialogue.
The following snippet shows how to compose the authorization request.
~~~~
https://demo.hitobito.ch/oauth/authorize
 ?response_type=code
 &client_id=abcDEFGhijK
 &redirect_uri=urn:ietf:wg:oauth:2.0:oob
 &scope=email%20name 
~~~~

`response_type` For the authorization request we always use "code"<br/>
`client_id` The public identifier for the application, get one from your application admin<br/>
`redirect_uri` Where to redirect the user and send the authorization code<br/>
`scope` One or more scopes, separated by string (or %20)<br/>

If the user accepts the request, the browser will redirect to the specified location. The authorization code will be available in the code URL parameter. Make sure this is a valid URL in your application. In this example we use the specific redirect_uri "urn:ietf:wg:oauth:2.0:oob" and signal we are manually copying the resulting code.

### Aquire an Access Token
The code returned by the Authorization Request can be used to aquire an access token.

~~~~
curl -X POST
 -H 'Accept: application/json'
 -d 'grant_type=authorization_code' 
 -d 'client_id=fec5519765de7f30c9017b46697bcb4071846e84374254287087f59869b97eca' 
 -d 'client_secret=2e1a8ef6676e3b9a13a75a7e6ae55879a02b8a5194af010dd8af0eb1a2ca0957' 
 -d 'redirect_uri=urn:ietf:wg:oauth:2.0:oob' 
 -d 'code=21ee8ad9de591870741e27664f7963b92e538829c3a7d8172a65ccb011b711d9' 
 https://demo.hitobito.ch/oauth/token
~~~~

`grant_type` For the token request we use "authorization_code"<br/>
`client_id` The public identifier for the application, ask your admin<br/>
`client_secret` The application secret, ask your admin<br/>
`redirect_uri` Must be the same value as in the authorization request<br/>
`code` The code received from the autorization request<br/>

### Use your Token
The freshly aquired token can be used as the Bearer when accessing the OAuth profile endpoint.
~~~~
curl 
 -H 'Authorization: Bearer 5dabc5cecbe8dbe6f2df91f42a86bad1938e5d09ecbbc29d9b06b6303fa654c5' 
 -H 'X-Scope: name' 
 https://demo.hitobito.ch/de/oauth/profile
~~~~

An example output could be
~~~~
{"id":34,"email":"julia@example.com","first_name":"Julia","last_name":"Keller","nickname":"Polka"}
~~~~
