## OAuth 2.0
With OAuth, users can grant access to their data from hitobito to other services without giving them their password.

For understanding how OAuth is used, the recommended ressource is https://www.oauth.com.

#### Creating OAuth Applications
Users with admin privilege on the application root group (e.g. "Bundesebene") are allowed to manage the OAuth applications.

Applications can be limited to a URL and access scope. The OAuth application is defined by it's Uid, generated by the system.

#### Scopes

| Name | Available user data |
| --- | --- |
| email | Id, Email |
| name | Name |
| with_roles | All the profile data, Roles within groups |

Multiple Scopes can be combined in a single Authorization Request.

## OAuth Flow

### Get the Userâ€™s Permission
If an application requests permission through OAuth, the users must first grant their permission through the authorize dialogue.
The following snippet shows how to compose the Authorization Request.
~~~~
https://demo.hitobito.ch/oauth/authorize
 ?response_type=code
 &client_id=abcDEFGhijK
 &redirect_uri=urn:ietf:wg:oauth:2.0:oob
 &scope=email%20name 
~~~~

`response_type` For the Grant Request we always use "code"
`client_id` The public identifier for the application, get one from your application admin
`redirect_uri` Where to redirect the user and send the authorization code
`scope` One or more Scopes, separated by string (or %20)

If the user accepts the request, the browser will redirect to the specified location. The Authorization Code will be available in the code URL parameter. Make sure this is a valid URL in your application. In this example we are manually copy/pasting the code from the browser and therefore use the specific redirect_uri for manual approaches "urn:ietf:wg:oauth:2.0:oob".

### Aquire an Access Token
The Code returned by the Authorization Request can be used to aquire an Access Token.

~~~~
curl -X POST
 -H 'Accept: application/json'
 -d 'grant_type=authorization_code' 
 -d 'client_id=fec5519765de7f30c9017b46697bcb4071846e84374254287087f59869b97eca' 
 -d 'client_secret=2e1a8ef6676e3b9a13a75a7e6ae55879a02b8a5194af010dd8af0eb1a2ca0957' 
 -d 'redirect_uri=urn:ietf:wg:oauth:2.0:oob' 
 -d 'code=21ee8ad9de591870741e27664f7963b92e538829c3a7d8172a65ccb011b711d9' 
 https://demo.hitobito.ch/oauth/token
~~~~

`grant_type` For the Token Request we use "authorization_code"
`client_id` The public identifier for the application, ask your admin
`client_secret` The application secret, ask your admin
`redirect_uri` Must be the same value as in the Authorization Request
`code` The code received from the Autorization Request

### Use your Token
The freshly aquired Token can be used as the Bearer Token when accessing the OAuth profile endpoint.
~~~~
curl 
 -H 'Authorization: Bearer 5dabc5cecbe8dbe6f2df91f42a86bad1938e5d09ecbbc29d9b06b6303fa654c5' 
 -H 'X-Scope: name' 
 https://demo.hitobito.ch/de/oauth/profile
~~~~

An Example output could be
~~~~
{"id":34,"email":"julia@example.com","first_name":"Julia","last_name":"Keller","nickname":"Polka"}
~~~~